    @Test
    public void testExistingTargetFileWithError()
            throws Exception {
        exit.expectSystemExitWithStatus(2);
        exit.checkAssertionAfterwards(new Assertion() {
            @Override
            public void checkAssertion() throws IOException {
                String currentPath = new File(".").getCanonicalPath();
                String expectedPath = currentPath
                    + "/src/test/resources/com/puppycrawl/tools/checkstyle/InputMain.java"
                    .replace("/", File.separator);
                assertEquals(String.format(Locale.ROOT, "Starting audit...%n"
                        + "%1$s:3:14: error: "
                        + "Name 'InputMain' must match pattern '^[a-z0-9]*$'.%n"
                        + "%1$s:5:7: error: "
                        + "Name 'InputMainInner' must match pattern '^[a-z0-9]*$'.%n"
                        + "Audit done.%n"
                        + "Checkstyle ends with 2 errors.%n", expectedPath), systemOut.getLog());
                assertEquals("", systemErr.getLog());
            }
        });
        Main.main("-c",
                "src/test/resources/com/puppycrawl/tools/checkstyle/config-classname2-error.xml",
                "src/test/resources/com/puppycrawl/tools/checkstyle/InputMain.java");
    }


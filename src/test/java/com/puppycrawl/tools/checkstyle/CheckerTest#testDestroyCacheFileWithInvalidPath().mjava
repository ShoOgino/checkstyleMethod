    @Test
    public void testDestroyCacheFileWithInvalidPath() throws Exception {
        final Checker checker = new Checker();
        final PackageObjectFactory factory = new PackageObjectFactory(
            new HashSet<String>(), Thread.currentThread().getContextClassLoader());
        checker.setModuleFactory(factory);
        checker.configure(new DefaultConfiguration("default config"));
        if (System.getProperty("os.name")
            .toLowerCase(Locale.ENGLISH).startsWith("windows")) {
            // https://support.microsoft.com/en-us/kb/177506 but this only for NTFS
            // WindowsServer 2012 use Resilient File System (ReFS), so any name is ok
            final File file = new File("C\\:invalid");
            checker.setCacheFile(file.getAbsolutePath());
        }
        else {
            final int wrongFileNameLength = 300;
            checker.setCacheFile(Strings.padEnd(File.separator, wrongFileNameLength, '*'));
        }
        try {
            checker.destroy();
            fail("Exception did not happen");
        }
        catch (IllegalStateException ex) {
            assertThat(ex.getCause(), anyOf(instanceOf(IOException.class),
                instanceOf(InvalidPathException.class)));
        }
    }


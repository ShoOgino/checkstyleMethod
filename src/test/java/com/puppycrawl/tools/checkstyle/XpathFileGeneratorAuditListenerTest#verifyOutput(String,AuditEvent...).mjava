    private static void verifyOutput(String expected, AuditEvent... events) throws IOException {
        final OutputStream out = spy(new ByteArrayOutputStream());
        final XpathFileGeneratorAuditListener listener =
                new XpathFileGeneratorAuditListener(out, AutomaticBean.OutputStreamOptions.CLOSE);

        for (AuditEvent event : events) {
            listener.addError(event);
        }

        listener.auditFinished(null);

        verify(out, times(1)).flush();
        verify(out, times(1)).close();

        final String actual = out.toString();
        assertEquals("Invalid suppressions file content", expected, actual);
    }


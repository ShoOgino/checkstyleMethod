    private static void verifyOutput(String expected, AuditEvent... events) {
        final TestByteArrayOutputStream out = new TestByteArrayOutputStream();

        final XpathFileGeneratorAuditListener listener =
                new XpathFileGeneratorAuditListener(out, AutomaticBean.OutputStreamOptions.CLOSE);

        for (AuditEvent event : events) {
            listener.addError(event);
        }

        listener.auditFinished(null);

        assertEquals("expected number of flushes", 1, out.flushCount);
        assertEquals("expected number of closes", 1, out.closeCount);

        final String actual = out.toString();
        assertEquals("Invalid suppressions file content", expected, actual);
    }


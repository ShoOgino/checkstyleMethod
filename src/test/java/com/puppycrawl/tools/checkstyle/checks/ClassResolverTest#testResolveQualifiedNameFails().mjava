    @Test
    public void testResolveQualifiedNameFails() throws Exception {
        final Set<String> imports = Sets.newHashSet();
        imports.add("java.applet.someClass");

        final ClassResolver classResolver = PowerMockito.spy(new ClassResolver(Thread
                .currentThread().getContextClassLoader(), "", imports));

        PowerMockito.doThrow(new ClassNotFoundException("expected exception"))
                .when(classResolver, "safeLoad", anyObject());
        PowerMockito.doReturn(true).when(classResolver, "isLoadable", anyObject());

        try {
            classResolver.resolve("someClass", "");
            fail("Exception expected");
        }
        catch (IllegalStateException e) {
            // expected
            assertTrue(e.getCause() instanceof ClassNotFoundException);
            assertTrue(e.getMessage().endsWith("expected exception"));
        }
    }


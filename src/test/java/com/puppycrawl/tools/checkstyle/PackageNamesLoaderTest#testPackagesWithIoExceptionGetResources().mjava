    @Test
    @SuppressWarnings("unchecked")
    public void testPackagesWithIoExceptionGetResources() throws Exception {

        final ClassLoader classLoader = mock(ClassLoader.class);
        when(classLoader.getResources("checkstyle_packages.xml")).thenThrow(IOException.class);

        try {
            PackageNamesLoader.getPackageNames(classLoader);
            fail("CheckstyleException is expected");
        }
        catch (CheckstyleException ex) {
            assertTrue("Invalid exception cause class", ex.getCause() instanceof IOException);
            assertEquals("Invalid exception message",
                    "unable to get package file resources", ex.getMessage());
        }
    }

